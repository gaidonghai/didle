"use strict";(self["webpackChunkdidle"]=self["webpackChunkdidle"]||[]).push([[291],{4291:(e,t,i)=>{i.r(t),i.d(t,{default:()=>U});var n=i(3673),s=i(2323);const l={class:"column justify-center items-center"},a={class:"q-ma-md"},o={height:"200",width:"200"},r=["points"],c={class:"row"},u=(0,n.Uk)("分享结果"),d=(0,n.Uk)("随机新局"),p={style:{color:"grey"}};function h(e,t,i,h,m,g){const f=(0,n.up)("q-table"),w=(0,n.up)("q-select"),y=(0,n.up)("q-btn"),b=(0,n.up)("q-page");return(0,n.wg)(),(0,n.j4)(b,null,{default:(0,n.w5)((()=>[(0,n._)("div",l,[(0,n._)("div",a,[((0,n.wg)(),(0,n.iD)("svg",o,[((0,n.wg)(!0),(0,n.iD)(n.HY,null,(0,n.Ko)(e.polygons,((e,t)=>((0,n.wg)(),(0,n.iD)("polygon",{key:t,points:e,fill:"#111111"},null,8,r)))),128))]))]),(0,n._)("div",null,[e.answers.length?((0,n.wg)(),(0,n.j4)(f,{key:0,columns:e.columnDef,pagination:{rowsPerPage:0},rows:e.answers,dense:"",flat:"","hide-bottom":"","hide-header":"",separator:"none"},null,8,["columns","rows"])):(0,n.kq)("",!0)]),(0,n._)("div",null,[(0,n.Wm)(w,{modelValue:e.userInput,"onUpdate:modelValue":[t[0]||(t[0]=t=>e.userInput=t),e.select],options:e.currentOptions,dense:"","emit-value":"","fill-input":"","hide-selected":"","input-debounce":"0",label:"输入名称或拼音检索","map-options":"","options-dense":"",outlined:"","use-input":"",onFilter:e.filterFn},null,8,["modelValue","options","onFilter","onUpdate:modelValue"])]),(0,n._)("div",c,[(0,n.Wm)(y,{class:"q-ma-sm",color:"secondary",onClick:e.copyClipboardGame},{default:(0,n.w5)((()=>[u])),_:1},8,["onClick"]),(0,n.Wm)(y,{class:"q-ma-sm",color:"primary",onClick:e.initialize},{default:(0,n.w5)((()=>[d])),_:1},8,["onClick"])]),(0,n._)("span",p,(0,s.zw)(e.currentUrl()),1)])])),_:1})}i(71),i(6016);var m=i(1999),g=i(8825);const f=(0,n.aZ)({name:"PageIndex",data(){return{cities:[],id:null,polygons:[],options:[],currentOptions:[],answers:[],userInput:"",notification:()=>{}}},setup(){let e=[];e.push({name:"attempt",label:"",field:e=>e.attempt,style:"padding-right:16px",align:"center"});for(let t=0;t<5;t++)e.push({name:String(t),label:"",field:(e=>t=>t.message[e])(t),style:"width:18px;"+(t<4?"padding:0":"padding-left:0"),align:"center"});return{quasar:(0,g.Z)(),columnDef:e}},async mounted(){this.cities=(await this.$api.get("/all")).data,this.currentOptions=this.options=this.cities.map(((e,t)=>({value:t,label:e.fullCH,search:e.fullCH+e.cityPY+e.cityInitialPY})));let e=new URLSearchParams(window.location.search);await this.initialize(e.get("id")||this.$route.params.id)},methods:{async initialize(e){e=Number(e),e||(e=Math.floor(1e6*Math.random())),this.polygons=[],this.answers=[],this.id=e,this.polygons=(await this.$api.get(`/svgPolygons/${this.id}`)).data;let t=this.cities[e%this.cities.length];console.log(`Game initialized with: ${e} (${t.fullCH})`)},currentUrl(){return window.location.origin+"/?id="+this.id},filterFn(e,t){t((()=>{const t=e.toLowerCase();this.currentOptions=this.options.filter((e=>e.search.toLowerCase().indexOf(t)>-1))}))},select(e){let t=this.cities[e],i=t.fullCH;console.log(`User selected: ${e} (${i})`),this.$api.get(`/${e}/${this.id}`).then((e=>{let t=e.data.distance,n=e.data.direction,s=n?"⬆↗➡↘⬇↙⬅↖⬆"[Math.round(n/45)]:"",l=(e,t,i=2,n=5)=>{if(e<=0)return 0;if(e<=t)return 1;let s;return s=Math.ceil(Math.log(e/t)/Math.log(i))+1,s=Math.min(s,n),s},a=l(t,150),o=Array(a).fill(s).join("")+Array(5-a).fill("✅").join("");console.log({distance:t,direction:n,message:o}),this.answers.push({attempt:i,message:o}),this.userInput=""}))},copyClipboardGame(){let e=[].concat("#Didle "+this.id).concat(this.answers.map((e=>e.message))).concat(this.currentUrl()).join("\n");(0,m.z)(e,void 0,(e=>{e?alert(e):(this.notification(),this.notification=this.quasar.notify({message:"已复制到剪贴板",color:"green",position:"top",timeout:1e3}))}))}}});var w=i(4260),y=i(4379),b=i(2659),C=i(6934),k=i(4607),v=i(7518),$=i.n(v);const q=(0,w.Z)(f,[["render",h]]),U=q;$()(f,"components",{QPage:y.Z,QTable:b.Z,QSelect:C.Z,QBtn:k.Z})}}]);